@{
    ViewData["Title"] = "Products";
    List<object> Model = ViewData["list"] as List<object>;
    List<object> ModelLoaiSP = ViewData["ListLoaiSP"] as List<object>;
    List<object> ModelHang = ViewData["ListHang"] as List<object>;
    List<object> ModelRam = ViewData["ListRam"] as List<object>;
    List<object> ModelMemory = ViewData["ListMemory"] as List<object>;
    List<object> ModelManHinh = ViewData["ListManHinh"] as List<object>;
    KhachHang kh = ViewBag.KH;
    Pager pager = new Pager();

    int pageNo = 0;
    if (ViewBag.Pager != null)
    {
        pager = ViewBag.Pager;
        pageNo = pager.CurrentPage;
    }
}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>@ViewData["Title"] - My Shop</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <style>
        /* Các style dùng cho giao diện sản phẩm */
        .product-card {
            margin-bottom: 20px;
        }

        .card {
            border: 1px solid #ddd;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background: #fff;
            border-radius: 8px; /* Bo tròn nhẹ */
            overflow: hidden; /* Đảm bảo các phần tử bên trong không vượt ra ngoài */
            height: 100%; /* Đồng nhất chiều cao card */
        }

            .card:hover {
                transform: translateY(-3px);
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            }

        .card-img-top {
            height: 250px;
            object-fit: cover; /* Làm đầy khung hình mà không làm méo ảnh */
            width: 100%;
        }

        .card-body {
            text-align: center;
            min-height: 150px; /* Đảm bảo đồng nhất kích thước phần thân card */
        }

        .card-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .card-text {
            font-size: 1rem;
        }

        .price del {
            font-size: 1.2rem;
        }

        .price ins {
            font-size: 1.4rem;
            font-weight: bold;
        }

        .card-footer {
            background: #fff;
            border-top: none;
            text-align: center;
            padding: 10px;
        }

            .card-footer .btn {
                border-radius: 20px;
                padding: 8px 20px;
                font-size: 1rem;
                transition: background 0.3s ease, transform 0.3s ease;
            }

                .card-footer .btn:hover {
                    transform: scale(1.05);
                }
        /* Kiểu icon cart: dùng glyphicon của Bootstrap */
        .btn .glyphicon-shopping-cart {
            margin-right: 5px;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <!-- Main Menu Area -->
    <div class="mainmenu-area">
        <div class="container">
            <div class="row">
                <div class="navbar-header">
                    <button type="button"
                            class="navbar-toggle"
                            data-toggle="collapse"
                            data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <div class="navbar-collapse collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="/Home/Index">Trang chủ</a></li>
                        <li class="active"><a href="/SanPham/Products">Sản phẩm</a></li>
                        <li><a href="/TinTuc/DanhSachTinTuc">Tin tức</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- End mainmenu area -->
    <!-- Title Area -->
    <div class="product-big-title-area">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="product-bit-title text-center">
                        <h2>Danh sách sản phẩm</h2>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Area -->
    <div class="single-product-area">
        <div class="container">
            <!-- Search và Sắp xếp -->
            <div class="row">
                <div class="col-sm-9">
                    <form action="/SanPham/Products">
                        <input type="search" name="search" class="form-control" placeholder="Search" style="float: left; width: 80%; margin-bottom: 20px;" />
                        <button type="submit" class="btn btn-primary" style="float: left; height: 34px; padding: 10px; width: 20%; margin-bottom: 20px;">
                            <i class="fas fa-search"></i>
                        </button>
                    </form>
                </div>
                <div class="col-sm-3">
                    <form action="/SanPham/Products" method="get">
                        <select name="sortOrder" id="sortOrder" onchange="sortProduct(this.value)" class="form-control" style="margin-bottom: 20px;">
                            <option value="">Chọn sắp xếp</option>
                            <option value="price_asc">Giá tăng dần</option>
                            <option value="price_desc">Giá giảm dần</option>
                            <option value="name_asc">Tên A-Z</option>
                            <option value="name_desc">Tên Z-A</option>
                        </select>
                    </form>
                </div>
            </div>

            <div class="row">
                <!-- Bộ lọc sản phẩm -->
                <div class="col-sm-3">
                    <form action="/SanPham/Products" method="get">
                        <div class="left-sidebar">
                            <div class="panel-group category-products" id="accordian">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h3 class="panel-title">
                                            <a data-toggle="collapse" data-parent="#accordian" href="#ram">
                                                <span class="badge pull-right"><i class="fa fa-plus"></i></span>
                                                <strong>BỘ LỌC</strong>
                                            </a>
                                        </h3>
                                    </div>
                                    <div id="ram" class="panel-collapse collapse">
                                        <div class="panel-body">
                                            <!-- Loại sản phẩm -->
                                            <div class="panel-heading">
                                                <h3 class="panel-title"><b>Loại sản phẩm</b></h3>
                                            </div>
                                            <div class="panel-body">
                                                <ul style="list-style:none">
                                                    @foreach (var hang in ModelLoaiSP)
                                                    {
                                                        <li>
                                                            <input type="checkbox" name="MaLoaiSP" value="@hang.GetType().GetProperty("MaLoaiSP").GetValue(hang, null)">
                                                            @hang.GetType().GetProperty("TenLoaiSP").GetValue(hang, null).ToString()
                                                        </li>
                                                    }
                                                </ul>
                                            </div>
                                            <hr />
                                            <!-- Ram -->
                                            <div class="panel-heading">
                                                <h3 class="panel-title"><b>Ram</b></h3>
                                            </div>
                                            <div class="panel-body">
                                                <ul style="list-style:none">
                                                    @foreach (var hang in ModelRam)
                                                    {
                                                        <li>
                                                            <input type="checkbox" name="Ram" value="@hang.GetType().GetProperty("Ram").GetValue(hang, null)">
                                                            @hang.GetType().GetProperty("Ram").GetValue(hang, null).ToString() GB
                                                        </li>
                                                    }
                                                </ul>
                                            </div>
                                            <hr />
                                            <!-- Bộ nhớ trong -->
                                            <div class="panel-heading">
                                                <h3 class="panel-title"><b>Bộ nhớ trong</b></h3>
                                            </div>
                                            <div class="panel-body">
                                                <ul style="list-style:none">
                                                    @foreach (var hang in ModelMemory)
                                                    {
                                                        <li>
                                                            <input type="checkbox" name="Memory" value="@hang.GetType().GetProperty("BoNhoTrong").GetValue(hang, null)">
                                                            @hang.GetType().GetProperty("BoNhoTrong").GetValue(hang, null).ToString() GB
                                                        </li>
                                                    }
                                                </ul>
                                            </div>
                                            <hr />
                                            <!-- Màn hình -->
                                            <div class="panel-heading">
                                                <h3 class="panel-title"><b>Màn hình</b></h3>
                                            </div>
                                            <div class="panel-body">
                                                <ul style="list-style:none">
                                                    @foreach (var hang in ModelManHinh)
                                                    {
                                                        <li>
                                                            <input type="checkbox" name="ScreenSize" value="@hang.GetType().GetProperty("kichthuocmanhinh").GetValue(hang, null)">
                                                            @hang.GetType().GetProperty("kichthuocmanhinh").GetValue(hang, null).ToString()
                                                        </li>
                                                    }
                                                </ul>
                                            </div>
                                            <hr />
                                            <!-- Hãng -->
                                            <div class="panel-heading">
                                                <h3 class="panel-title"><b>Hãng</b></h3>
                                            </div>
                                            <div class="panel-body">
                                                <ul style="list-style:none">
                                                    @foreach (var hang in ModelHang)
                                                    {
                                                        <li>
                                                            <input type="checkbox" name="MaTH" value="@hang.GetType().GetProperty("MaTH").GetValue(hang, null)">
                                                            @hang.GetType().GetProperty("TenTH").GetValue(hang, null).ToString()
                                                        </li>
                                                    }
                                                </ul>
                                            </div>
                                            <hr />
                                            <button type="submit" onchange="this.form.submit()">Lọc sản phẩm</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Hiển thị sản phẩm -->
                <div class="col-sm-9 padding-right">
                    @foreach (var item in Model)
                    {
                        <div class="col-md-4 col-sm-6 product-card">
                            <div class="card h-100">
                                <img src="@item.GetType().GetProperty("HinhAnh").GetValue(item, null).ToString()" class="card-img-top" alt="Hình ảnh sản phẩm">
                                <div class="card-body">
                                    <h5 class="card-title">
                                        @item.GetType().GetProperty("TenSP").GetValue(item, null).ToString()
                                    </h5>
                                    <p class="card-text">
                                        @item.GetType().GetProperty("MauSac").GetValue(item, null).ToString() -
                                        @item.GetType().GetProperty("Ram").GetValue(item, null).ToString()GB -
                                        @item.GetType().GetProperty("BoNhoTrong").GetValue(item, null).ToString()GB
                                    </p>
                                    <div class="price">
                                        @if (int.Parse(item.GetType().GetProperty("GiaKM").GetValue(item, null).ToString()) > 0)
                                        {
                                            <p><del class="text-muted">@string.Format("{0:0,0 đ}", item.GetType().GetProperty("Gia").GetValue(item, null))</del></p>
                                            <p><ins class="text-danger">@string.Format("{0:0,0 đ}", item.GetType().GetProperty("GiaKM").GetValue(item, null))</ins></p>
                                        }
                                        else
                                        {
                                            <p><ins class="text-primary">@string.Format("{0:0,0 đ}", item.GetType().GetProperty("Gia").GetValue(item, null))</ins></p>
                                        }
                                    </div>
                                </div>
                                <div class="card-footer">
                                    <button type="button" class="btn btn-success add-to-cart" data-id="@item.GetType().GetProperty("MaTTSP").GetValue(item, null)">
                                        <span class="glyphicon glyphicon-shopping-cart"></span> Thêm vào giỏ hàng
                                    </button>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
            <!-- Phân trang -->
            <div class="row">
                <div class="col-md-12">
                    <div class="product-pagination text-center">
                        <nav>
                            @if (pager.TotalPages > 0)
                            {
                                <ul class="pagination">
                                    <li>
                                        <a href="javascript:void(0);" onclick="navigatePage(@(pager.CurrentPage - 1))" aria-label="Previous">
                                            <span aria-hidden="true">&laquo;</span>
                                        </a>
                                    </li>
                                    @for (var pge = pager.StartPage; pge <= pager.EndPage; pge++)
                                    {
                                        <li class="page-item @(pge == pager.CurrentPage ? "active" : "")">
                                            <a class="page-link" href="javascript:void(0);" onclick="navigatePage(@pge)">@pge</a>
                                        </li>
                                    }
                                    <li>
                                        <a href="javascript:void(0);" onclick="navigatePage(@(pager.CurrentPage + 1))" aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                </ul>
                            }
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Script xử lý phân trang, sắp xếp và lọc -->
    <script>
        function navigatePage(pageNumber) {
            var currentUrl = window.location.href;
            var cleanUrl = currentUrl.replace(/([?&]pg=\d+)/, '');
            var newUrl = cleanUrl + (cleanUrl.includes('?') ? '&' : '?') + 'pg=' + pageNumber;
            window.location.href = newUrl;
        }
        function getParameterByName(name) {
            const url = new URL(window.location.href);
            return url.searchParams.get(name);
        }
        document.addEventListener("DOMContentLoaded", function () {
            const sortOrder = getParameterByName("sortOrder");
            if (sortOrder) {
                document.getElementById("sortOrder").value = sortOrder;
            }
            var params = new URLSearchParams(window.location.search);
            // Xử lý MaLoaiSP
            var maloaispValues = params.getAll("MaLoaiSP");
            if (maloaispValues.length > 0) {
                var checkboxes = document.querySelectorAll('input[name="MaLoaiSP"]');
                checkboxes.forEach(function (checkbox) {
                    if (maloaispValues.includes(checkbox.value)) {
                        checkbox.checked = true;
                    }
                });
            }
            // Xử lý Ram
            var ramValues = params.getAll("Ram");
            if (ramValues.length > 0) {
                var checkboxes = document.querySelectorAll('input[name="Ram"]');
                checkboxes.forEach(function (checkbox) {
                    if (ramValues.includes(checkbox.value)) {
                        checkbox.checked = true;
                    }
                });
            }
            // Xử lý Memory
            var memoryValues = params.getAll("Memory");
            if (memoryValues.length > 0) {
                var checkboxes = document.querySelectorAll('input[name="Memory"]');
                checkboxes.forEach(function (checkbox) {
                    if (memoryValues.includes(checkbox.value)) {
                        checkbox.checked = true;
                    }
                });
            }
            // Xử lý ScreenSize
            var screenValues = params.getAll("ScreenSize");
            if (screenValues.length > 0) {
                var checkboxes = document.querySelectorAll('input[name="ScreenSize"]');
                checkboxes.forEach(function (checkbox) {
                    if (screenValues.includes(checkbox.value)) {
                        checkbox.checked = true;
                    }
                });
            }
            // Xử lý MaTH
            var mathValues = params.getAll("MaTH");
            if (mathValues.length > 0) {
                var checkboxes = document.querySelectorAll('input[name="MaTH"]');
                checkboxes.forEach(function (checkbox) {
                    if (mathValues.includes(checkbox.value)) {
                        checkbox.checked = true;
                    }
                });
            }
        });
        function sortProduct(sortInfor) {
            var currentUrl = window.location.href;
            var cleanUrl = currentUrl.replace(/([?&]sortOrder=[^&]*)/, '');
            var newUrl = cleanUrl + (cleanUrl.includes('?') ? '&' : '?') + 'sortOrder=' + sortInfor;
            window.location.href = newUrl;
        }
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</body>
</html>
y